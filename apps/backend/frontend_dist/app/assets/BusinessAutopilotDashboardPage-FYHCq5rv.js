import{r as v,j as e,L as I,P as ee,a as O}from"./index-B_kdSSa9.js";const te="wz_business_autopilot_crm_module",se="wz_business_autopilot_ticketing_module",z="wz_business_autopilot_accounts_module",ne="wz_business_autopilot_hr_module",G=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];function ae(r){const c=new Date(r);return Number.isNaN(c.getTime())?null:c}function J(r=[],c,g){const a=new Map;return(r||[]).forEach(i=>{const y=g.map(o=>i==null?void 0:i[o]).find(Boolean),x=ae(y);if(!x)return;const u=x.getFullYear(),M=x.getMonth(),p=Number((i==null?void 0:i[c])||(i==null?void 0:i.amount)||0);!Number.isFinite(p)||p<=0||(a.has(u)||a.set(u,Array(12).fill(0)),a.get(u)[M]+=p)}),a}function H(r){const c=r%100;return G.map((g,a)=>{const i=45e3+(c*97+a*43)%38e3,y=[1,.92,1.05,1.12,.98,1.08,1.2,1.1,1.16,1.28,1.34,1.48][a];return Math.round(i*y)})}function K(r,c,g,a){if(!Array.isArray(r)||!r.length)return"";const i=g-20,y=c/Math.max(1,r.length-1);return r.map((x,u)=>{const M=a>0?x/a:0,p=u*y,o=i-i*M+6;return`${p},${o}`}).join(" ")}function W(r){const c=r instanceof Date?r:new Date(r);if(Number.isNaN(c.getTime()))return"";const g=c.getFullYear(),a=String(c.getMonth()+1).padStart(2,"0"),i=String(c.getDate()).padStart(2,"0");return`${g}-${a}-${i}`}function ie(r,c=[]){const g=new Date(r.getFullYear(),r.getMonth(),1),a=new Date(g.getFullYear(),g.getMonth(),1),i=new Date(g.getFullYear(),g.getMonth()+1,0),y=(a.getDay()+6)%7,x=new Date(a);x.setDate(a.getDate()-y);const u=new Map;(c||[]).forEach(p=>{const o=String((p==null?void 0:p.meetingDate)||"").trim();o&&(u.has(o)||u.set(o,[]),u.get(o).push(p))});const M=Array.from({length:35}).map((p,o)=>{const N=new Date(x);N.setDate(x.getDate()+o);const f=W(N);return{isoDate:f,day:N.getDate(),inMonth:N.getMonth()===a.getMonth(),isToday:f===W(new Date),meetings:(u.get(f)||[]).slice().sort((D,w)=>String(D.meetingTime||"").localeCompare(String(w.meetingTime||"")))}});return{monthLabel:a.toLocaleString("en-US",{month:"long",year:"numeric"}),monthStart:a,monthEnd:i,cells:M}}function B({title:r,currentYear:c,currentSeries:g=[],previousYear:a,previousSeries:i=[],icon:y="bi-graph-up",yPrefix:x="INR "}){const p=Math.max(1,...g,...i),o=K(g,420,180,p),N=K(i,420,180,p),f=g.reduce((b,T)=>b+Number(T||0),0),D=i.reduce((b,T)=>b+Number(T||0),0),w=D>0?(f-D)/D*100:0;return e.jsxs("div",{className:"card p-3 h-100",children:[e.jsxs("div",{className:"d-flex align-items-center justify-content-between mb-2",children:[e.jsxs("div",{className:"d-flex align-items-center gap-2",children:[e.jsx("div",{className:"stat-icon stat-icon-primary flex-shrink-0 d-inline-flex align-items-center justify-content-center",style:{width:32,height:32},children:e.jsx("i",{className:`bi ${y}`,"aria-hidden":"true",style:{fontSize:"1.15rem",lineHeight:1}})}),e.jsxs("div",{children:[e.jsx("h6",{className:"mb-0",children:r}),e.jsxs("div",{className:"text-secondary small",children:[a," vs ",c]})]})]}),e.jsxs("div",{className:"text-end",children:[e.jsx("div",{className:"small text-secondary",children:"Current Year Total"}),e.jsxs("div",{className:"fw-semibold",children:[x,Math.round(f).toLocaleString("en-IN")]})]})]}),e.jsxs("div",{className:"position-relative",children:[e.jsxs("svg",{viewBox:"0 0 420 180",className:"w-100",role:"img","aria-label":`${r} monthly comparison`,children:[[.25,.5,.75,1].map(b=>e.jsx("line",{x1:"0",x2:420,y1:160-160*b+6,y2:160-160*b+6,stroke:"var(--bs-border-color)",strokeOpacity:"0.6",strokeWidth:"1"},b)),e.jsx("polyline",{points:N,fill:"none",stroke:"var(--bs-secondary-color)",strokeOpacity:"0.95",strokeWidth:"3",strokeLinecap:"round",strokeLinejoin:"round"}),e.jsx("polyline",{points:o,fill:"none",stroke:"var(--bs-primary)",strokeWidth:"3.5",strokeLinecap:"round",strokeLinejoin:"round"})]}),e.jsx("div",{className:"d-flex justify-content-between small text-secondary px-1 mt-1",children:G.map(b=>e.jsx("span",{children:b},b))})]}),e.jsxs("div",{className:"d-flex flex-wrap align-items-center gap-3 mt-2 small",children:[e.jsxs("span",{className:"d-inline-flex align-items-center gap-1",children:[e.jsx("span",{style:{width:12,height:2,background:"var(--bs-secondary-color)",opacity:.95,display:"inline-block"}}),a," (Previous)"]}),e.jsxs("span",{className:"d-inline-flex align-items-center gap-1",children:[e.jsx("span",{style:{width:12,height:2,background:"var(--bs-primary)",display:"inline-block"}}),c," (Current)"]}),e.jsxs("span",{className:`ms-auto fw-semibold ${w>=0?"text-success":"text-danger"}`,children:[w>=0?"+":"",w.toFixed(1),"%"]})]})]})}function le({modules:r=[],catalog:c=[],canManageModules:g=!1,onToggleModule:a,savingModuleSlug:i="",moduleError:y="",productBasePath:x="",subscriptions:u=[]}){const[M,p]=v.useState([]),[o,N]=v.useState({}),[f,D]=v.useState(new Date().getFullYear()),[w,b]=v.useState([]),[T,U]=v.useState(()=>{const t=new Date;return new Date(t.getFullYear(),t.getMonth(),1)}),[_,Q]=v.useState({myAttendance:0,userCount:0,billPendingAmount:0,openTickets:0,todayMeetings:0,myPlans:Array.isArray(u)?u.length:0}),F=Array.isArray(r)?r:[],q=Array.isArray(c)&&c.length?c:F;v.useEffect(()=>{let t=!0;async function m(){try{const h=await O("/api/dashboard/summary");if(!t)return;p(Array.isArray(h==null?void 0:h.products)?h.products:[])}catch{t&&p([])}}return m(),()=>{t=!1}},[]),v.useEffect(()=>{let t=!0;async function m(){try{const h=await O("/api/business-autopilot/accounts/workspace");if(!t)return;N((h==null?void 0:h.workspace)||{})}catch{try{const h=window.localStorage.getItem(z),A=h?JSON.parse(h):{};t&&N(A||{})}catch{t&&N({})}}}return m(),()=>{t=!1}},[]),v.useEffect(()=>{let t=!0;async function m(){let h=0,A=0,C=0,Y=0,k=0;const E=Array.isArray(u)?u.length:0,$=new Date().toISOString().slice(0,10);try{const l=window.localStorage.getItem(ne),n=l?JSON.parse(l):{};h=(Array.isArray(n==null?void 0:n.attendance)?n.attendance:[]).some(s=>String((s==null?void 0:s.date)||"").trim()===$)?1:0}catch{h=0}try{const l=await O("/api/business-autopilot/users");A=Array.isArray(l==null?void 0:l.users)?l.users.length:0}catch{A=0}try{const l=await O("/api/business-autopilot/accounts/workspace"),n=(l==null?void 0:l.workspace)||{};C=(Array.isArray(n==null?void 0:n.invoices)?n.invoices:[]).filter(s=>{const d=String((s==null?void 0:s.status)||"").toLowerCase();return!["paid","cancelled"].includes(d)}).reduce((s,d)=>s+Number((d==null?void 0:d.total)||0),0)}catch{try{const l=window.localStorage.getItem(z),n=l?JSON.parse(l):{};C=(Array.isArray(n==null?void 0:n.invoices)?n.invoices:[]).filter(s=>{const d=String((s==null?void 0:s.status)||"").toLowerCase();return!["paid","cancelled"].includes(d)}).reduce((s,d)=>s+Number((d==null?void 0:d.total)||0),0)}catch{C=0}}try{const l=window.localStorage.getItem(se),n=l?JSON.parse(l):{};Y=(Array.isArray(n==null?void 0:n.tickets)?n.tickets:[]).filter(s=>String((s==null?void 0:s.status)||"").toLowerCase()!=="closed").length}catch{Y=0}try{const l=window.localStorage.getItem(te),n=l?JSON.parse(l):{},S=Array.isArray(n==null?void 0:n.meetings)?n.meetings:[];t&&b(S),k=S.filter(s=>String((s==null?void 0:s.meetingDate)||"").trim()===$).length}catch{t&&b([]),k=0}t&&Q({myAttendance:h,userCount:A,billPendingAmount:C,openTickets:Y,todayMeetings:k,myPlans:E})}return m(),()=>{t=!1}},[u]);const L=v.useMemo(()=>ie(T,w),[w,T]);function R(t){U(m=>new Date(m.getFullYear(),m.getMonth()+t,1))}const V=t=>{const m=(t==null?void 0:t.path)||`/${(t==null?void 0:t.slug)||""}`;return x?m==="/"?x:`${x}${m.startsWith("/")?m:`/${m}`}`:m},P=t=>!t||t==="#"?"#":x?`${x}${t.startsWith("/")?t:`/${t}`}`:t,X=t=>`INR ${Number(t||0).toLocaleString("en-IN",{minimumFractionDigits:2,maximumFractionDigits:2})}`,Z=[{key:"myAttendance",label:"My Attendance",value:String(_.myAttendance||0),icon:"bi-calendar-check",href:P("/hrm#attendance")},{key:"users",label:"Total Users",value:String(_.userCount||0),icon:"bi-people",href:P("/users")},{key:"billing",label:"Bill Pendings",value:X(_.billPendingAmount),icon:"bi-wallet2",href:P("/billing")},{key:"tickets",label:"Open Tickets",value:String(_.openTickets||0),icon:"bi-life-preserver",href:P("/ticketing")},{key:"meetings",label:"Today Meetings",value:String(_.todayMeetings||0),icon:"bi-calendar-event",href:"#"},{key:"plans",label:"My Plans",value:String(_.myPlans||0),icon:"bi-clipboard-check",href:P("/plans")}],j=v.useMemo(()=>{const t=Array.isArray(o==null?void 0:o.invoices)?o.invoices:[],m=Array.isArray(o==null?void 0:o.expenses)?o.expenses:[],h=J(t,"total",["issueDate","date","createdAt"]),A=J(m,"amount",["date","expenseDate","createdAt"]),C=new Set([new Date().getFullYear(),f,f-1]);h.forEach((s,d)=>C.add(d)),A.forEach((s,d)=>C.add(d));const Y=Array.from(C).sort((s,d)=>d-s).slice(0,6),k=Y.includes(f)?f:Y[0]||new Date().getFullYear(),E=k-1,$=h.get(k)||H(k),l=h.get(E)||H(E).map(s=>Math.round(s*.86));let n=A.get(k),S=A.get(E);return n||(n=$.map((s,d)=>Math.round(s*(.46+d%4*.03)))),S||(S=l.map((s,d)=>Math.round(s*(.44+d%3*.025)))),{yearOptions:Y,selectedYear:k,previousYear:E,salesCurrent:$,salesPrevious:l,expensesCurrent:n,expensesPrevious:S}},[o,f]);return e.jsxs("div",{children:[e.jsx("h4",{className:"mb-2",children:"Business Autopilot ERP"}),e.jsx("p",{className:"text-secondary mb-3",children:"Modular suite for CRM, HR, Projects, Accounts, Ticketing, and Stocks."}),e.jsx("div",{className:"row g-3 mb-3",children:Z.map(t=>e.jsx("div",{className:"col-12 col-md-6 col-xl-2",children:e.jsx("div",{className:"card p-3 h-100",children:e.jsxs("div",{className:"d-flex flex-column align-items-center justify-content-center text-center h-100",children:[e.jsx("div",{className:"stat-icon stat-icon-primary mb-2",children:e.jsx("i",{className:`bi ${t.icon}`,"aria-hidden":"true"})}),e.jsxs("div",{className:"min-w-0",children:[t.href==="#"?e.jsx("a",{href:"#",className:"fw-semibold text-decoration-none d-inline-block",children:t.label}):e.jsx(I,{to:t.href,className:"fw-semibold text-decoration-none d-inline-block",children:t.label}),e.jsx("div",{className:"h5 mb-0 mt-1",children:t.value})]})]})})},t.key))}),y?e.jsx("div",{className:"alert alert-danger py-2",children:y}):null,F.length?e.jsx("div",{className:"row g-3",children:F.map(t=>e.jsx("div",{className:"col-12 col-md-6 col-xl-2",children:e.jsxs("div",{className:"card p-3 h-100 d-flex flex-column",children:[e.jsx("h6",{className:"mb-1",children:t.name}),e.jsx("div",{className:"text-secondary small mb-2",children:"Module Enabled"}),e.jsx(I,{className:"btn btn-primary btn-sm mt-auto",to:V(t),children:"Open"})]})},t.slug))}):e.jsx("div",{className:"alert alert-warning mb-0",children:"No modules are enabled for this organization yet."}),e.jsx("div",{style:{marginTop:"40px"},children:e.jsxs("div",{className:"row g-3",children:[e.jsxs("div",{className:"col-12 col-xl-8",children:[e.jsxs("div",{className:"d-flex flex-wrap align-items-center justify-content-between gap-2 mb-3",children:[e.jsx("h4",{className:"mb-0",children:"Monthly Sales & Expenses Comparison"}),e.jsxs("div",{className:"d-flex align-items-center gap-2",children:[e.jsx("label",{className:"small text-secondary mb-0",htmlFor:"baerp-comparison-year",children:"Year"}),e.jsx("select",{id:"baerp-comparison-year",className:"form-select form-select-sm",style:{minWidth:"110px"},value:j.selectedYear,onChange:t=>D(Number(t.target.value)),children:j.yearOptions.map(t=>e.jsx("option",{value:t,children:t},t))})]})]}),e.jsxs("div",{className:"row g-3",children:[e.jsx("div",{className:"col-12 col-lg-6",children:e.jsx(B,{title:"Monthly Sales",icon:"bi-graph-up-arrow",currentYear:j.selectedYear,previousYear:j.previousYear,currentSeries:j.salesCurrent,previousSeries:j.salesPrevious})}),e.jsx("div",{className:"col-12 col-lg-6",children:e.jsx(B,{title:"Monthly Expenses",icon:"bi-graph-down-arrow",currentYear:j.selectedYear,previousYear:j.previousYear,currentSeries:j.expensesCurrent,previousSeries:j.expensesPrevious})})]})]}),e.jsx("div",{className:"col-12 col-xl-4",children:e.jsxs("div",{className:"card p-3 h-100",children:[e.jsxs("div",{className:"d-flex align-items-center justify-content-between gap-2 mb-2",children:[e.jsx("h6",{className:"mb-0",children:"Meeting Calendar"}),e.jsxs("div",{className:"d-flex align-items-center gap-1",children:[e.jsx("button",{type:"button",className:"btn btn-sm btn-outline-light",onClick:()=>R(-1),children:e.jsx("i",{className:"bi bi-chevron-left","aria-hidden":"true"})}),e.jsx("button",{type:"button",className:"btn btn-sm btn-outline-light",onClick:()=>R(1),children:e.jsx("i",{className:"bi bi-chevron-right","aria-hidden":"true"})})]})]}),e.jsx("div",{className:"small text-secondary mb-2",children:L.monthLabel}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(7, minmax(0, 1fr))",gap:"6px"},children:[["Mon","Tue","Wed","Thu","Fri","Sat","Sun"].map(t=>e.jsx("div",{className:"small text-secondary text-center fw-semibold",children:t},`head-${t}`)),L.cells.map(t=>{var m;return e.jsxs("div",{className:"rounded",style:{minHeight:"56px",border:"1px solid rgba(255,255,255,0.08)",padding:"4px",background:t.isToday?"rgba(var(--bs-primary-rgb),0.12)":"rgba(255,255,255,0.02)",opacity:t.inMonth?1:.45},title:t.meetings.length?`${t.meetings.length} meeting(s)`:"",children:[e.jsx("div",{className:"small fw-semibold",style:{lineHeight:1.1},children:t.day}),t.meetings.length?e.jsxs("div",{className:"mt-1",children:[e.jsx("span",{className:"badge bg-success",style:{fontSize:"0.65rem"},children:t.meetings.length}),(m=t.meetings[0])!=null&&m.meetingTime?e.jsx("div",{className:"small text-truncate mt-1",style:{fontSize:"0.68rem"},children:String(t.meetings[0].meetingTime)}):null]}):null]},t.isoDate)})]})]})})]})}),g?e.jsxs("div",{className:"mt-4",children:[e.jsx("h6",{className:"mb-2",children:"Module Access Settings"}),e.jsx("div",{className:"text-secondary small mb-3",children:"Enable or disable eligible ERP modules for your organization."}),e.jsx("div",{className:"row g-2",children:q.map(t=>e.jsx("div",{className:"col-12 col-md-6 col-xl-2",children:e.jsxs("div",{className:"d-flex align-items-center justify-content-between border rounded px-2 py-2 h-100 gap-2",children:[e.jsxs("div",{className:"min-w-0",children:[e.jsx("div",{className:"fw-semibold",children:t.name}),e.jsx("div",{className:"text-secondary small",children:t.eligible?t.enabled?"Enabled":"Disabled":"Plan Locked"})]}),e.jsx("div",{className:"flex-shrink-0",children:e.jsx("button",{type:"button",className:`btn btn-sm ${t.enabled?"btn-outline-danger":"btn-outline-success"}`,disabled:i===t.slug||t.eligible===!1,onClick:()=>a&&a(t.slug,!t.enabled),children:i===t.slug?"Saving...":t.eligible===!1?"Locked":t.enabled?"Disable":"Enable"})})]})},`toggle-${t.slug}`))})]}):null,e.jsx(ee,{products:M,subscriptions:u,currentProductKey:"business-autopilot-erp"})]})}export{le as default};
