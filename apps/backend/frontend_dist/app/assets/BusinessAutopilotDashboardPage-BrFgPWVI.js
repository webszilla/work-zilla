import{r as w,j as e,L as F,P as U,a as L}from"./index-CsafN1Zc.js";const Q="wz_business_autopilot_ticketing_module",O="wz_business_autopilot_accounts_module",B=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];function q(r){const o=new Date(r);return Number.isNaN(o.getTime())?null:o}function R(r=[],o,y){const c=new Map;return(r||[]).forEach(a=>{const f=y.map(d=>a==null?void 0:a[d]).find(Boolean),u=q(f);if(!u)return;const h=u.getFullYear(),C=u.getMonth(),b=Number((a==null?void 0:a[o])||(a==null?void 0:a.amount)||0);!Number.isFinite(b)||b<=0||(c.has(h)||c.set(h,Array(12).fill(0)),c.get(h)[C]+=b)}),c}function D(r){const o=r%100;return B.map((y,c)=>{const a=45e3+(o*97+c*43)%38e3,f=[1,.92,1.05,1.12,.98,1.08,1.2,1.1,1.16,1.28,1.34,1.48][c];return Math.round(a*f)})}function J(r,o,y,c){if(!Array.isArray(r)||!r.length)return"";const a=y-20,f=o/Math.max(1,r.length-1);return r.map((u,h)=>{const C=c>0?u/c:0,b=h*f,d=a-a*C+6;return`${b},${d}`}).join(" ")}function z({title:r,currentYear:o,currentSeries:y=[],previousYear:c,previousSeries:a=[],icon:f="bi-graph-up",yPrefix:u="INR "}){const b=Math.max(1,...y,...a),d=J(y,420,180,b),Y=J(a,420,180,b),k=y.reduce((x,M)=>x+Number(M||0),0),E=a.reduce((x,M)=>x+Number(M||0),0),v=E>0?(k-E)/E*100:0;return e.jsxs("div",{className:"card p-3 h-100",children:[e.jsxs("div",{className:"d-flex align-items-center justify-content-between mb-2",children:[e.jsxs("div",{className:"d-flex align-items-center gap-2",children:[e.jsx("div",{className:"stat-icon stat-icon-primary",style:{width:34,height:34},children:e.jsx("i",{className:`bi ${f}`,"aria-hidden":"true"})}),e.jsxs("div",{children:[e.jsx("h6",{className:"mb-0",children:r}),e.jsxs("div",{className:"text-secondary small",children:[c," vs ",o]})]})]}),e.jsxs("div",{className:"text-end",children:[e.jsx("div",{className:"small text-secondary",children:"Current Year Total"}),e.jsxs("div",{className:"fw-semibold",children:[u,Math.round(k).toLocaleString("en-IN")]})]})]}),e.jsxs("div",{className:"position-relative",children:[e.jsxs("svg",{viewBox:"0 0 420 180",className:"w-100",role:"img","aria-label":`${r} monthly comparison`,children:[[.25,.5,.75,1].map(x=>e.jsx("line",{x1:"0",x2:420,y1:160-160*x+6,y2:160-160*x+6,stroke:"rgba(255,255,255,0.08)",strokeWidth:"1"},x)),e.jsx("polyline",{points:Y,fill:"none",stroke:"rgba(255,255,255,0.35)",strokeWidth:"3",strokeLinecap:"round",strokeLinejoin:"round"}),e.jsx("polyline",{points:d,fill:"none",stroke:"var(--bs-primary)",strokeWidth:"3.5",strokeLinecap:"round",strokeLinejoin:"round"})]}),e.jsx("div",{className:"d-flex justify-content-between small text-secondary px-1 mt-1",children:B.map(x=>e.jsx("span",{children:x},x))})]}),e.jsxs("div",{className:"d-flex flex-wrap align-items-center gap-3 mt-2 small",children:[e.jsxs("span",{className:"d-inline-flex align-items-center gap-1",children:[e.jsx("span",{style:{width:12,height:2,background:"rgba(255,255,255,0.35)",display:"inline-block"}}),c," (Previous)"]}),e.jsxs("span",{className:"d-inline-flex align-items-center gap-1",children:[e.jsx("span",{style:{width:12,height:2,background:"var(--bs-primary)",display:"inline-block"}}),o," (Current)"]}),e.jsxs("span",{className:`ms-auto fw-semibold ${v>=0?"text-success":"text-danger"}`,children:[v>=0?"+":"",v.toFixed(1),"%"]})]})]})}function X({modules:r=[],catalog:o=[],canManageModules:y=!1,onToggleModule:c,savingModuleSlug:a="",moduleError:f="",productBasePath:u="",subscriptions:h=[]}){const[C,b]=w.useState([]),[d,Y]=w.useState({}),[k,E]=w.useState(new Date().getFullYear()),[v,x]=w.useState({userCount:0,billPendingAmount:0,openTickets:0,todayMeetings:0,newInboxAlert:0,myPlans:Array.isArray(h)?h.length:0}),M=Array.isArray(r)?r:[],W=Array.isArray(o)&&o.length?o:M;w.useEffect(()=>{let s=!0;async function m(){try{const l=await L("/api/dashboard/summary");if(!s)return;b(Array.isArray(l==null?void 0:l.products)?l.products:[])}catch{s&&b([])}}return m(),()=>{s=!1}},[]),w.useEffect(()=>{let s=!0;async function m(){try{const l=await L("/api/business-autopilot/accounts/workspace");if(!s)return;Y((l==null?void 0:l.workspace)||{})}catch{try{const l=window.localStorage.getItem(O),j=l?JSON.parse(l):{};s&&Y(j||{})}catch{s&&Y({})}}}return m(),()=>{s=!1}},[]),w.useEffect(()=>{let s=!0;async function m(){var T,I;let l=0,j=0,S=0,$=0,A=0;const P=Array.isArray(h)?h.length:0;try{const t=await L("/api/business-autopilot/users");l=Array.isArray(t==null?void 0:t.users)?t.users.length:0}catch{l=0}try{const t=await L("/api/business-autopilot/accounts/workspace"),i=(t==null?void 0:t.workspace)||{};j=(Array.isArray(i==null?void 0:i.invoices)?i.invoices:[]).filter(n=>{const g=String((n==null?void 0:n.status)||"").toLowerCase();return!["paid","cancelled"].includes(g)}).reduce((n,g)=>n+Number((g==null?void 0:g.total)||0),0)}catch{try{const t=window.localStorage.getItem(O),i=t?JSON.parse(t):{};j=(Array.isArray(i==null?void 0:i.invoices)?i.invoices:[]).filter(n=>{const g=String((n==null?void 0:n.status)||"").toLowerCase();return!["paid","cancelled"].includes(g)}).reduce((n,g)=>n+Number((g==null?void 0:g.total)||0),0)}catch{j=0}}try{const t=window.localStorage.getItem(Q),i=t?JSON.parse(t):{};S=(Array.isArray(i==null?void 0:i.tickets)?i.tickets:[]).filter(n=>String((n==null?void 0:n.status)||"").toLowerCase()!=="closed").length}catch{S=0}try{const t=await L("/api/dashboard/summary"),i=(t==null?void 0:t.unread_notifications)??(t==null?void 0:t.new_inbox_alert)??(t==null?void 0:t.inbox_alerts)??((T=t==null?void 0:t.alerts)==null?void 0:T.inbox)??((I=t==null?void 0:t.notifications)==null?void 0:I.unread)??0;A=Number(i)||0}catch{A=0}s&&x({userCount:l,billPendingAmount:j,openTickets:S,todayMeetings:$,newInboxAlert:A,myPlans:P})}return m(),()=>{s=!1}},[h]);const K=s=>{const m=(s==null?void 0:s.path)||`/${(s==null?void 0:s.slug)||""}`;return u?m==="/"?u:`${u}${m.startsWith("/")?m:`/${m}`}`:m},_=s=>!s||s==="#"?"#":u?`${u}${s.startsWith("/")?s:`/${s}`}`:s,G=s=>`INR ${Number(s||0).toLocaleString("en-IN",{minimumFractionDigits:2,maximumFractionDigits:2})}`,H=[{key:"users",label:"Total Users",value:String(v.userCount||0),icon:"bi-people",href:_("/users")},{key:"billing",label:"Bill Pendings",value:G(v.billPendingAmount),icon:"bi-wallet2",href:_("/billing")},{key:"tickets",label:"Open Tickets",value:String(v.openTickets||0),icon:"bi-life-preserver",href:_("/ticketing")},{key:"meetings",label:"Today Meetings",value:String(v.todayMeetings||0),icon:"bi-calendar-event",href:"#"},{key:"inbox",label:"New Inbox Alert",value:String(v.newInboxAlert||0),icon:"bi-bell",href:_("/notifications-inbox")},{key:"plans",label:"My Plans",value:String(v.myPlans||0),icon:"bi-clipboard-check",href:_("/plans")}],N=w.useMemo(()=>{const s=Array.isArray(d==null?void 0:d.invoices)?d.invoices:[],m=Array.isArray(d==null?void 0:d.expenses)?d.expenses:[],l=R(s,"total",["issueDate","date","createdAt"]),j=R(m,"amount",["date","expenseDate","createdAt"]),S=new Set([new Date().getFullYear(),k,k-1]);l.forEach((p,n)=>S.add(n)),j.forEach((p,n)=>S.add(n));const $=Array.from(S).sort((p,n)=>n-p).slice(0,6),A=$.includes(k)?k:$[0]||new Date().getFullYear(),P=A-1,T=l.get(A)||D(A),I=l.get(P)||D(P).map(p=>Math.round(p*.86));let t=j.get(A),i=j.get(P);return t||(t=T.map((p,n)=>Math.round(p*(.46+n%4*.03)))),i||(i=I.map((p,n)=>Math.round(p*(.44+n%3*.025)))),{yearOptions:$,selectedYear:A,previousYear:P,salesCurrent:T,salesPrevious:I,expensesCurrent:t,expensesPrevious:i}},[d,k]);return e.jsxs("div",{children:[e.jsx("h4",{className:"mb-2",children:"Business Autopilot ERP"}),e.jsx("p",{className:"text-secondary mb-3",children:"Modular suite for CRM, HR, Projects, Accounts, Ticketing, and Stocks."}),e.jsx("div",{className:"row g-3 mb-3",children:H.map(s=>e.jsx("div",{className:"col-12 col-md-6 col-xl-2",children:e.jsx("div",{className:"card p-3 h-100",children:e.jsxs("div",{className:"d-flex flex-column align-items-center justify-content-center text-center h-100",children:[e.jsx("div",{className:"stat-icon stat-icon-primary mb-2",children:e.jsx("i",{className:`bi ${s.icon}`,"aria-hidden":"true"})}),e.jsxs("div",{className:"min-w-0",children:[s.href==="#"?e.jsx("a",{href:"#",className:"fw-semibold text-decoration-none d-inline-block",children:s.label}):e.jsx(F,{to:s.href,className:"fw-semibold text-decoration-none d-inline-block",children:s.label}),e.jsx("div",{className:"h5 mb-0 mt-1",children:s.value})]})]})})},s.key))}),f?e.jsx("div",{className:"alert alert-danger py-2",children:f}):null,M.length?e.jsx("div",{className:"row g-3",children:M.map(s=>e.jsx("div",{className:"col-12 col-md-6 col-xl-2",children:e.jsxs("div",{className:"card p-3 h-100 d-flex flex-column",children:[e.jsx("h6",{className:"mb-1",children:s.name}),e.jsx("div",{className:"text-secondary small mb-2",children:"Module Enabled"}),e.jsx(F,{className:"btn btn-primary btn-sm mt-auto",to:K(s),children:"Open"})]})},s.slug))}):e.jsx("div",{className:"alert alert-warning mb-0",children:"No modules are enabled for this organization yet."}),y?e.jsxs("div",{className:"mt-3",children:[e.jsx("h6",{className:"mb-2",children:"Module Access Settings"}),e.jsx("div",{className:"text-secondary small mb-3",children:"Enable or disable eligible ERP modules for your organization."}),e.jsx("div",{className:"row g-2",children:W.map(s=>e.jsx("div",{className:"col-12 col-md-6 col-xl-2",children:e.jsxs("div",{className:"d-flex align-items-center justify-content-between border rounded px-2 py-2 h-100 gap-2",children:[e.jsxs("div",{className:"min-w-0",children:[e.jsx("div",{className:"fw-semibold",children:s.name}),e.jsx("div",{className:"text-secondary small",children:s.enabled?"Enabled":"Disabled"})]}),e.jsx("div",{className:"flex-shrink-0",children:e.jsx("button",{type:"button",className:`btn btn-sm ${s.enabled?"btn-outline-danger":"btn-outline-success"}`,disabled:a===s.slug,onClick:()=>c&&c(s.slug,!s.enabled),children:a===s.slug?"Saving...":s.enabled?"Disable":"Enable"})})]})},`toggle-${s.slug}`))})]}):null,e.jsx(U,{products:C,subscriptions:h,currentProductKey:"business-autopilot-erp"}),e.jsxs("div",{className:"mt-4",children:[e.jsxs("div",{className:"d-flex flex-wrap align-items-center justify-content-between gap-2 mb-3",children:[e.jsx("h4",{className:"mb-0",children:"Monthly Sales & Expenses Comparison"}),e.jsxs("div",{className:"d-flex align-items-center gap-2",children:[e.jsx("label",{className:"small text-secondary mb-0",htmlFor:"baerp-comparison-year",children:"Year"}),e.jsx("select",{id:"baerp-comparison-year",className:"form-select form-select-sm",style:{minWidth:"110px"},value:N.selectedYear,onChange:s=>E(Number(s.target.value)),children:N.yearOptions.map(s=>e.jsx("option",{value:s,children:s},s))})]})]}),e.jsxs("div",{className:"row g-3",children:[e.jsx("div",{className:"col-12 col-xl-6",children:e.jsx(z,{title:"Monthly Sales",icon:"bi-graph-up-arrow",currentYear:N.selectedYear,previousYear:N.previousYear,currentSeries:N.salesCurrent,previousSeries:N.salesPrevious})}),e.jsx("div",{className:"col-12 col-xl-6",children:e.jsx(z,{title:"Monthly Expenses",icon:"bi-graph-down-arrow",currentYear:N.selectedYear,previousYear:N.previousYear,currentSeries:N.expensesCurrent,previousSeries:N.expensesPrevious})})]})]})]})}export{X as default};
