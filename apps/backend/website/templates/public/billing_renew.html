{% extends "public/base.html" %}
{% block meta_title %}Work Zilla | Renew Subscription{% endblock %}
{% block meta_description %}Renew your subscription and submit payment for approval.{% endblock %}
{% block body_class %}account-page{% endblock %}

{% block content %}
<section class="section">
  <div class="site-container account-layout">
    <div class="account-header">
      <h1 class="section-title">Renew Subscription</h1>
      <p class="section-lead">Confirm your plan and submit renewal payment for approval.</p>
    </div>

    <div class="account-grid">
      <aside class="account-menu">
        {% include "public/partials/account_sidebar.html" %}
      </aside>

      <div class="account-content card p-4">
        <h2 class="section-title">Selected Plan</h2>
        <div class="plan-summary mt-3">
          <div class="plan-summary__row">
            <span>Product</span>
            <strong>{{ selected_plan.product.name|default:"Work Suite" }}</strong>
          </div>
          <div class="plan-summary__row">
            <span>Plan</span>
            <strong>{{ selected_plan.name }}</strong>
          </div>
          <div class="plan-summary__row">
            <span>Billing Cycle</span>
            <strong>{{ selected_billing|title }}</strong>
          </div>
          <div class="plan-summary__row">
            <span>Currency</span>
            <strong>{{ selected_currency|upper }}</strong>
          </div>
        </div>

        <h3 class="section-title mt-4">Add-on Users</h3>
        <p class="text-secondary">Adjust add-on seats if needed. Amount recalculates on submission.</p>
        <form class="mt-3" method="post" action="/my-account/billing/renew/confirm/">
          {% csrf_token %}
          {% if has_pending_renewal %}
            <div class="alert alert-warning">
              Renewal already submitted. Awaiting admin approval.
            </div>
          {% endif %}
          <div class="form-grid">
            <div class="form-field">
              <label>Add-on Users</label>
              <input type="number" name="addon_count" min="0" value="{{ addon_count|default:0 }}">
            </div>
            <div class="form-field">
              <label>Base Price</label>
              <input type="text" value="{{ selected_currency|upper }} {{ base_price }}" readonly>
            </div>
            <div class="form-field">
              <label>Add-on Price (per user)</label>
              <input type="text" value="{{ selected_currency|upper }} {{ addon_price }}" readonly>
            </div>
            <div class="form-field">
              <label>Estimated Total</label>
              <input type="text" value="{{ selected_currency|upper }} {{ total_price }}" readonly>
            </div>
          </div>

          <h3 class="section-title mt-4">Bank Transfer Details</h3>
          <div class="form-grid">
            <div class="form-field">
              <label>UTR / Reference (optional)</label>
              <input type="text" name="utr_number" placeholder="UTR number">
            </div>
            <div class="form-field">
              <label>Paid Date (optional)</label>
              <input type="date" name="paid_on">
            </div>
            <div class="form-field form-field--full">
              <label>Notes (optional)</label>
              <textarea name="notes" rows="3" placeholder="Add payment notes"></textarea>
            </div>
          </div>

          {% if has_pending_renewal %}
            <button class="btn btn-outline mt-3" type="submit" disabled aria-disabled="true">
              Renewal Submitted
            </button>
          {% else %}
            <button class="btn btn-outline mt-3" type="submit">
              Submit Renewal Payment
            </button>
          {% endif %}
        </form>
      </div>
    </div>
  </div>
</section>
{% endblock %}
