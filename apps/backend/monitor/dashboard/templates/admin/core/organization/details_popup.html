{% extends "admin/base_site.html" %}
{% load static %}
{% block content %}

<link rel="stylesheet" href="{% static 'css/admin.css' %}">

<h2>Organization Details</h2>

<div class="org-details-grid">
  <div class="org-details-left">
    <div class="card p-3 h-100">
      <p><b>Name:</b> {{ org.name }}</p>
      <p><b>Company Key:</b> {{ org.company_key }}</p>
      <p><b>Owner:</b> {{ org.owner.username }}</p>
      <p><b>Owner Email:</b> {{ org.owner.email|default:"-" }}</p>
      <p><b>Employees:</b> {{ employees_count }}</p>
    </div>
  </div>

  <div class="org-details-right">
    <div class="card p-3 h-100">
      <h4>Billing History</h4>
      <div class="d-flex justify-content-end mb-2">
        <form method="get" class="d-flex gap-2 align-items-center">
          <input type="text" name="q" class="admin-search-input" placeholder="Search history" value="{{ search_query }}">
          <button class="admin-search-btn" type="submit">Search</button>
        </form>
      </div>
      <div class="table-responsive">
        <table class="table table-dark table-striped table-hover align-middle mt-2">
          <thead>
            <tr>
              <th>Plan</th>
              <th>Status</th>
              <th>Billing Cycle</th>
              <th>Retention Days</th>
              <th>Add-ons</th>
              <th>Start Date</th>
              <th>End Date</th>
            </tr>
          </thead>
          <tbody>
            {% for s in subs %}
              <tr>
                <td>{{ s.plan.name }}</td>
                <td>{{ s.status }}</td>
                <td>{{ s.billing_cycle }}</td>
                <td>{{ s.retention_days }}</td>
                <td>{{ s.addon_count }}</td>
                <td>{{ s.start_date }}</td>
                <td>{{ s.end_date|default:"-" }}</td>
              </tr>
            {% empty %}
              <tr>
                <td colspan="7">No subscription history available.</td>
              </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
      <div style="margin-top:12px; text-align:center;">
        {% if subs.has_previous %}
          <a href="?page={{ subs.previous_page_number }}{% if search_query %}&q={{ search_query }}{% endif %}">Prev</a>
        {% endif %}
        <span style="margin:0 10px;">
          Page {{ subs.number }} of {{ subs.paginator.num_pages }}
        </span>
        {% if subs.has_next %}
          <a href="?page={{ subs.next_page_number }}{% if search_query %}&q={{ search_query }}{% endif %}">Next</a>
        {% endif %}
      </div>
    </div>
  </div>
</div>

{% endblock %}

